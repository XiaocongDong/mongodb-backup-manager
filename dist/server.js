module.exports=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var o=n(41),r=(n(8),n(43)),a={auth:{username:"admin",password:"admin",token_exp_time:36e5},database:{server:"localhost",port:27017,backup_config_db:"backup",database_backup_roles:["readWrite","dbOwner"],all_database_backup_roles:["readWriteAnyDatabase"]},server:{port:8082,interval:2e3,logLevel:"info"}},i={requirements:{auth:{mandatory:[{key:"username",type:String},{key:"password",type:String},{key:"token_exp_time",type:Number}],optional:[]},database:{mandatory:[{key:"server",type:String},{key:"port",type:Number},{key:"backup_config_db",type:String},{key:"database_backup_roles",type:Array},{key:"all_database_backup_roles",type:Array}],optional:[{key:"username",type:String},{key:"password",type:String},{key:"authDB",type:String}]},server:{mandatory:[{key:"port",type:Number},{key:"interval",type:Number},{key:"logLevel",type:String}]}},cmds:{auth:[],database:[{cmd:"dbServer",key:"server"},{cmd:"dbPort",key:"port"},{cmd:"username",key:"username"},{cmd:"password",key:"password"},{cmd:"authDB",key:"authDB"}],server:[{cmd:"serverPort",key:"port"},{cmd:"interval",key:"interval"},{cmd:"log",key:"logLevel"}]},config:{},setConfig:function(e){var t=e.config;if(null!=t){if(!o.existsSync(t))throw new Error("Import Error: "+t+" doesn't exist in the system");i.config=i.readConfig(t)}else{for(var n in i.cmds){var r=i.cmds[n],u=!0,c=!1,s=void 0;try{for(var l,f=r[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var p=l.value;e.hasOwnProperty(p.cmd)&&(a[n][p.key]=e[p.cmd])}}catch(e){c=!0,s=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw s}}}i.config=a}for(var d in i.requirements){if(!i.config.hasOwnProperty(d))throw new Error("Configuration Error: no "+d+" is sepcified");var h=i.requirements[d],k=h.mandatory,g=!0,b=!1,v=void 0;try{for(var m,y=k[Symbol.iterator]();!(g=(m=y.next()).done);g=!0){var B=m.value;if(!i.config[d].hasOwnProperty(B.key))throw new Error("Configuration Error: "+d+" error: no "+B.key+" is specified");if(i.config[d][B.key].constructor!==B.type)throw new Error("Configuration Error: "+d+" error: "+B.key+" must be a "+B.type.name)}}catch(e){b=!0,v=e}finally{try{!g&&y.return&&y.return()}finally{if(b)throw v}}}},readConfig:function(e){var t=o.readFileSync(e,"utf-8");return JSON.parse(r(t))}};e.exports=i},function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Error occurred.",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;return"object"===(void 0===e?"undefined":o(e))?{body:e,code:t}:{body:{message:e},code:t}},success:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return"object"===(void 0===e?"undefined":o(e))?{body:e,code:t}:e?{body:{message:e},code:t}:{code:t}},send:function(e,t){e.status(t.code).send(t.body)}};e.exports=r},function(e,t,n){"use strict";var o=n(38),r=n(1).config;o.setLevel(r.server.logLevel);var a={showTimestamp:!0},i=new o(a);e.exports=i},function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(20),u=n(5),c=n(6),s=n(2),l=n(14),f=n(9),p=n(3),d=function(){function e(){r(this,e),this.localDB=null,this.serverSocket=null,this.backUpsHash=new Map}return a(e,[{key:"setLocalDB",value:function(e){this.localDB=e}},{key:"setServerSocket",value:function(e){this.serverSocket=e}},{key:"getBackupManager",value:function(e){return this.backUpsHash.get(e)}},{key:"newBackup",value:function(e,t){var n=this;if(e.id=l.getBackupID(e),this.backUpsHash.has(e.id))return t(s.error("Created backup failed: "+e.id+" has existed",409));var o=u.selfish(new f(e)),r=e.server,a=e.username,c=e.authDB,d=e.db,h=e.collections;o.connect().catch(function(n){throw t(s.error("Failed to connected to "+e.server)),n}).then(function(){return o.getAvailableBackupCollections()}).then(function(t){var o=t.filter(function(e){return e.db==d});if(0===o.length)throw new Error(d+" doesn't exist in "+r+" or "+a+"@"+c+" can't backup it");if(o=o[0],h){var i=h.filter(function(e){return!o.collections.includes(e)});if(i.length>0)throw new Error("backup collections "+i+" don't exist")}return l.updateBackupData(e),n.localDB.updateBackupConfig(e)}).then(function(){p.info("Created backup config for "+e.id);var o=u.selfish(new i(n.localDB,e,n.serverSocket));o.start(),n.backUpsHash.set(e.id,o),n.getBackupStatus(e.id,t)}).catch(function(e){t(s.error(e.message))}).finally(function(){o.close()})}},{key:"runBackup",value:function(e,t){if(!this.backUpsHash.has(e))return t(s.error("Can't not update a nonexistent backup"));var n=this.backUpsHash.get(e);n.backup().then(function(){var e=n.nextBackupTime,o={status:c.backup.result.SUCCEED};e&&(o.nextBackupTime=e),t(s.success(o))}).catch(function(e){var o=n.nextBackupTime,r={status:c.backup.result.FAILED,reason:e.message};o&&(r.nextBackupTime=o),t(s.error(r))})}},{key:"restore",value:function(e,t,n,o){if(!this.backUpsHash.has(e))return o(s.error("Can't not restore for nonexistent backup id "+e));this.backUpsHash.get(e).restore(t,n).then(function(){o(s.success("Successfully restore "+e+" from "+t))}).catch(function(n){console.error(n),o(s.error("Failed to restore "+e+" from "+t+" for "+n.message))})}},{key:"updateBackupConfig",value:function(e,t,n){if(!this.backUpsHash.has(e))return n(s.error("Can't not update a nonexistent backup",404));this.backUpsHash.get(e).updateBackupConfig(t).then(function(){n(s.success("Updated backup config for "+e))}).catch(function(e){n(s.error("Failed to update backup config for "+e.message))})}},{key:"stop",value:function(e,t){if(!this.backUpsHash.has(e))return t(s.error(e+" doesn't exist",404));this.backUpsHash.get(e).stop().then(function(){t(s.success("Stopped "+e))}).catch(function(n){t(s.error("Failed to stop "+e+" for "+n.message))})}},{key:"resume",value:function(e,t){if(!this.backUpsHash.has(e))return t(s.error(e+" doesn't exist",404));var n=this.backUpsHash.get(e);if(n.backupStatus!=c.backup.status.STOP)return t(s.error("Failed to resume backup for "+e+" for current status is "+n.backupStatus));n.resume().then(function(){t(s.success("Resumed backup for "+e+" successfully"))}).catch(function(e){t(s.error("Failed to resume backup for "+e.message))})}},{key:"getBackupStatus",value:function(e,t){if(!this.backUpsHash.has(e))return t(s.error(e+" doesn't exist",404));var n=this.backUpsHash.get(e),o=n.backupStatus,r=n.nextBackupTime,a={status:o,id:e};return o==c.backup.status.WAITING&&r&&(a.nextBackupTime=r.toLocaleString()),t(s.success(a))}},{key:"deleteBackup",value:function(e,t){var n=this;if(!this.backUpsHash.has(e))return t(s.error("backupID "+e+" doesn't exist",404));var o=this.backUpsHash.get(e);if(o.backupStatus==c.backup.status.RUNNING)return t(s.error("Failed to delete running backup"));o.clear().then(function(){n.backUpsHash.delete(e),t(s.success("Successfully deleted "+e))}).catch(function(e){t(s.error(e,message))})}},{key:"deleteDB",value:function(e,t,n){if(!this.backUpsHash.has(e))return n(s.error("backupID "+e+" doesn't exist",404));this.backUpsHash.get(e).deleteCopyDB(t).then(function(){return n(s.success("Successfully deleted "+t))}).catch(function(e){return n(s.error(error.message))})}},{key:"deleteCollections",value:function(e,t,n,o){if(!this.backUpsHash.has(e))return o(s.error("backupID "+e+" doesn't exist"));this.backUpsHash.get(e).deleteCollections(t,n).then(function(){o(s.success("Deleted "+n+" of "+t+" in "+e))}).catch(function(e){o(s.error("Failed to deleted "+n+" in "+t+" for "+e.message))})}},{key:"getAvailableDBsCollections",value:function(e,t){var n=e.server,o=e.port,r=e.username,a=e.password,i=e.authDB,c=u.selfish(new f({server:n,port:o,username:r,password:a,authDB:i}));c.connect().catch(function(e){throw t(s.error(e.message,401)),e}).then(c.getAvailableBackupCollections).then(function(e){c.close(),t(s.success(e))}).catch(function(e){throw c.close(),t(s.error(e.message,400)),e})}},{key:"getCollections",value:function(e,t,n){if(!this.backUpsHash.has(e))return n(s.error("backupID "+e+" doesn't exist",404));this.backUpsHash.get(e).getCollections(t).then(function(e){n(s.success(e))}).catch(function(e){n(s.error(""+e.message))})}},{key:"getDataFromCollection",value:function(e,t,n,o){if(!this.backUpsHash.has(e))return o(s.error("backupID "+e+" doesn't exist",404));this.backUpsHash.get(e).getDataFromCollection(t,n,{}).then(function(e){o(s.success(e))}).catch(function(e){o(s.error("Failed to read data from "+n+" of "+t+" for "+e.message))})}},{key:"getAllBackupConfigs",value:function(e){this.localDB.getBackupConfigs().then(function(t){e(s.success(t))}).catch(function(t){e(s.error("Failed to get all the backup configs for "+t.message))})}},{key:"getBackupConfig",value:function(e,t){this.localDB.getBackupConfig(e).then(function(e){if(0==e.length)return t(s.success(null));t(s.success(e[0]))}).catch(function(n){t(s.error("Failed to get "+e+" backup config for "+n.message))})}},{key:"getBackupCopyDBs",value:function(e,t){this.localDB.getBackupCopyDBsWithId(e).then(function(e){t(s.success(e))}).catch(function(e){t(s.error(e.message))})}},{key:"getAllBackupCopyDBs",value:function(e){this.localDB.getAllCopyDBs().then(function(t){e(s.success(t))}).catch(function(t){e(s.error("Failed to get all copy dbs for "+t.message))})}},{key:"getAllOriginalDBs",value:function(e){var t=this;Promise.all([].concat(o(this.backUpsHash.keys())).map(function(e){return t.backUpsHash.get(e).getOriginalDB()})).then(function(t){return e(s.success(t))}).catch(function(t){return e(s.error(t.message))})}},{key:"getOriginalDB",value:function(e,t){if(!this.backUpsHash.has(e))return t(s.error("backupID "+e+" doesn't exist",404));this.backUpsHash.get(e).getOriginalDB().then(function(e){return t(s.success(e))}).catch(function(e){return t(s.error(e.message))})}},{key:"getAllBackupLogs",value:function(e,t){this.localDB.getBackupLogs(e).then(function(e){return t(s.success(e))}).catch(function(e){return t(s.error(e.message))})}},{key:"restart",value:function(){var e=this;this.localDB.getBackupConfigs().then(function(t){0!=t.length&&t.map(function(t){p.info("Restarted "+t.id+" from "+e.localDB.server+" "+e.localDB.configCollectionName);var n=u.selfish(new i(e.localDB,t,e.serverSocket));p.debug("Added "+t.id+" to the backup controller"),e.backUpsHash.set(t.id,n),n.restart()})})}}]),e}(),h=Symbol.for("controller");global[h]||(global[h]=u.selfish(new d)),e.exports=global[h]},function(e,t,n){"use strict";var o={};o.selfish=function(e){var t=new WeakMap,n={get:function(e,n){var o=Reflect.get(e,n);return"function"!=typeof o?o:(t.has(o)||t.set(o,o.bind(e)),t.get(o))}};return new Proxy(e,n)},o.deployPromiseFinally=function(){Promise.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})}},o.sortByTime=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.sort(function(e,o){var r=new Date(e[t]),a=new Date(o[t]),i=r>a?1:r<a?-1:0;return n?-1*i:i})},e.exports=o},function(e,t,n){"use strict";var o=n(21),r=n(22),a={backup:o,task:r};e.exports=a},function(e,t,n){"use strict";var o=n(1).config,r=n(10),a={localDB:null,setDB:function(e){a.localDB=e},newToken:function(e){var t={};return t.crt=(new Date).valueOf(),t.exp_time=t.crt+o.auth.token_exp_time,t.token=a._generateToken(),t.ip=r.getIp(e),t.user_agent=r.getUserAgent(e),t.valid=!0,t},_generateToken:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<64;++n)e+=t.charAt(Math.floor(Math.random()*t.length));return e},setTokenToDB:function(e){return a.localDB.setToken(e)},getTokensFromDB:function(e){return a.localDB.getToken(e)},invalidateTokens:function(e){return a.localDB.updateTokens({$set:{valid:!1}},e)}};e.exports=a},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(42).MongoClient,i=n(37),u=(n(5),n(1).config.database),c=n(3),s=function(){function e(t){var n=t.server,r=t.port,a=t.username,i=t.password,u=t.authDB,c=void 0===u?"admin":u;o(this,e),this.db=null,this.dbHash=new Map,this.connections=0,this.setConnectionParams({server:n,port:r,username:a,password:i,authDB:c})}return r(e,[{key:"setConnectionParams",value:function(e){var t=e.server,n=e.port,o=e.username,r=e.password,a=e.authDB,u=void 0===a?"admin":a;return this.server=t,this.port=n,this.userName=o,this.password=r,this.authDB=u,this.url=i.getMongoUri(o,r,t,n,u),this}},{key:"connect",value:function(){var e=this;return Promise.resolve().then(function(){if(e.connections++,!e.db)return a.connect(e.url).then(function(t){c.debug("connected to "+e.url),e.db=t}).catch(function(t){throw c.error("Failed to connect to "+e.url+" for "+t.message),new Error(t)})})}},{key:"close",value:function(){var e=this;return Promise.resolve().then(function(){return e.connections--,e.connections>0?void c.debug("Some activities are still running, can't close the mongo connection"):null==e.db?void c.debug(e.url+" is not connected"):e.db.close().then(function(t){e.db=null,e.dbHash.clear()}).catch(function(t){throw c.error("Failed to close "+e.url+" for "+t.message),t})})}},{key:"getUserRole",value:function(){var e=this;return Promise.resolve().then(function(){return e.db.command({usersInfo:e.userName})}).catch(function(t){throw c.error("Failed to get "+e.userName+" for "+t.message),t}).then(function(t){var n=t.users;if(0==n.length)throw new Error("no user "+e.userName+" found");return n[0]})}},{key:"getAvailableDBsWithRoles",value:function(e){var t=this;return Promise.resolve().then(function(){return t.getUserRole()}).then(function(t){return t.roles.filter(function(t){var n=t.role;return e.includes(n)}).map(function(e){return e.db})})}},{key:"getAvailableDBsWithAdminDb",value:function(){var e=this;return Promise.resolve().then(function(){return e.db.admin().listDatabases()}).then(function(e){return e.databases.map(function(e){return e.name})}).catch(function(e){throw c.error("Failed to get available backup dbs for "+e.message),e})}},{key:"getAvailableDBs",value:function(){var e=this;return Promise.resolve().then(function(){return e.userName?"admin"==e.authDB?e.getUserRole().then(function(t){return t.roles.filter(function(e){var t=e.role;e.db;return u.all_database_backup_roles.includes(t)}).length>0?e.getAvailableDBsWithAdminDb():[]}):e.getAvailableDBsWithRoles(u.database_backup_roles):e.getAvailableDBsWithAdminDb()})}},{key:"getCollectionNamesWithDB",value:function(e){var t=this;return Promise.resolve().then(function(){return t.getDBByName(e).listCollections().toArray()}).then(function(e){return e.filter(function(e){return!e.name.match(/system\.[\w+]+/)}).map(function(e){return e.name})}).catch(function(t){throw c.error("Failed to get all "+e+" collections for "+t.message),t})}},{key:"getAvailableBackupCollections",value:function(){var e=this;return Promise.resolve().then(function(){return e.getAvailableDBs()}).then(function(t){return Promise.all(t.map(function(t){return new Promise(function(n,o){e.getCollectionNamesWithDB(t).then(function(e){return n({db:t,collections:e})}).catch(function(e){return o(e)})})}))})}},{key:"updateDocsInCollection",value:function(e,t,n,o){var r=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new Promise(function(i,u){r.getDBByName(e).collection(t,{strict:!1},function(e,t){if(e)return u(e);var r=null;r=a?t.updateMany(o,n,{upsert:!1}):t.updateOne(o,n,{upsert:!0,w:1}),r.then(function(e){i()}).catch(function(e){u(e)})})})}},{key:"readFromCollection",value:function(e,t,n){var o=this;return new Promise(function(r,a){o.getDBByName(e).collection(t,{strict:!1},function(e,t){if(e)return a(e);t.find(n).toArray(function(e,t){if(e)return a(e);r(t)})})})}},{key:"readFromCollections",value:function(e,t){var n=this;return Promise.resolve().then(function(){return Promise.all(t.map(function(t){return Promise.resolve().then(function(){return n.readFromCollection(e,t,{})}).then(function(n){return c.debug("Read from "+t+" of "+e),{collection:t,docs:n}}).catch(function(n){throw c.error("Failed to read from "+t+" of "+e+" for "+n.message),n})}).map(function(e){return e.catch(function(e){return e})}))}).then(function(n){var o=n.filter(function(e){return e instanceof Error});if(o.length>0)throw c.error("Failed to read all the data from "+t+" of "+e+" for "+o[0].message),o[0];return c.debug("Finished read data from the "+t+" of "+e),n})}},{key:"writeToCollections",value:function(e,t){var n=this;return Promise.resolve().then(function(){return Promise.all(t.map(function(t){return Promise.resolve().then(function(){var o=t.collection,r=t.docs;return n.writeToCollection(e,o,r)})}).map(function(e){return e.catch(function(e){return e})}))}).then(function(t){var n=t.filter(function(e){return e instanceof Error});if(n.length>0)throw c.error("Failed to backup all the data to "+e+" for "+n[0].message),n[0];c.debug("wrote all the data to "+e)})}},{key:"writeToCollection",value:function(e,t,n){var o=this;return new Promise(function(r,a){o.getDBByName(e).collection(t,{strict:!1},function(i,u){if(i)return c.err("Failed to write for "+t+" of "+e+" for "+i.message),a(i);0==n.length?(c.debug(t+" is empty"),o.getDBByName(e).createCollection(t).then(function(){c.debug("Created empty "+t+" in "+e),r()}).catch(function(n){c.error("Failed to create empty "+t+" in "+e+" for "+n.message),a(n)})):u.insertMany(n).then(function(n){c.debug("Wrote to "+t+" of "+e),r()}).catch(function(n){c.error("Failed to write to "+t+" of "+e+" for "+n.message),a(n)})})})}},{key:"deleteDocs",value:function(e,t,n){var o=this;return new Promise(function(r,a){o.getDBByName(e).collection(t,{strict:!1},function(e,t){if(e)return c.error("Failed to delete docs for "+e.message),a(e);t.deleteMany(n).then(function(){r()}).catch(function(e){return c.error("Failed to delete docs with "+n+" for "+e.message),a(e)})})})}},{key:"deleteDatabase",value:function(e){var t=this;return Promise.resolve().then(function(){return t.getDBByName(e).dropDatabase()})}},{key:"deleteCollections",value:function(e,t){var n=this;return Promise.all(t.map(function(t){return n.getDBByName(e).dropCollection(t).catch(function(e){if(!e.message.includes("ns not found"))throw e})}))}},{key:"getDBByName",value:function(e){return this.dbHash.has(e)||this.dbHash.set(e,this.db.db(e)),this.dbHash.get(e)}}]),e}();e.exports=s},function(e,t,n){"use strict";var o={getIp:function(e){return e.ip||e.headers["x-forwarded-for"]||e.connection.remoteAddress},getUserAgent:function(e){return e.headers["user-agent"]}};e.exports=o},function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(5),u=n(3),c=n(13),s=n(6),l=function(){function e(){r(this,e),this.taskSet=new Set}return a(e,[{key:"setController",value:function(e){this.controller=e}},{key:"start",value:function(e){setInterval(this.scan.bind(this),e)}},{key:"removeTasksWithBackupId",value:function(e){this.taskSet=new Set([].concat(o(this.taskSet)).filter(function(t){return t.backupId!==e}))}},{key:"addTask",value:function(e){this.taskSet.add(e)}},{key:"scan",value:function(){u.debug("Start scanning the task pool at "+(new Date).toLocaleString()),u.debug("whole task",this.taskSet);var e=this.getAvailableTasks();u.debug("avaliable task",e);var t=!0,n=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var i=r.value;this.executeTask(i)}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"getAvailableTasks",value:function(){var e=this,t=[];return this.taskSet.forEach(function(n){new Date>=new Date(n.time)&&(t.push(n),e.taskSet.delete(n))}),t}},{key:"executeTask",value:function(e){var t=this.controller.getBackupManager(e.backupId);if(!t)return void u.error(e.backupId+" doesn't exist!");switch(e.action){case s.task.BACKUP:t.backup();var n=e.details.interval;if(n){var o=(new Date).valueOf()+n,r=c.newTask(e.backupId,o,s.task.BACKUP,{interval:n});this.addTask(r);var a=new Date(o).toLocaleString();t.updateBackupConfigToDB({nextBackupTime:a})}break;case s.task.DELETE_DB:var i=e.details.dbName;t.deleteCopyDB(i)}}}]),e}(),f=Symbol.for("taskPool");global[f]||(global[f]=i.selfish(new l)),e.exports=global[f]},function(e,t,n){"use strict";var o={AUTH_ERROR:"authentication error",CODE:401};e.exports=o},function(e,t,n){"use strict";var o={newTask:function(e,t,n,r){return{id:o.getTaskId(),backupId:e,time:t,action:n,details:r}},getTaskId:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<64;++n)e+=t.charAt(Math.floor(Math.random()*t.length));return e}};e.exports=o},function(e,t,n){"use strict";var o=n(6),r={optionalKeys:["collections","startTime","interval","maxBackupNumber","duration"],getBackupID:function(e){return e.db+"@"+e.server},getNextBackupTime:function(e){var t=e.startTime,n=e.nextBackupTime,o=new Date;if(n){var r=new Date(n);if(r>o)return r}return t&&(t=new Date(t))<o&&(t=new Date(o.getFullYear(),o.getMonth(),o.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))<o&&(t=new Date(t.valueOf()+864e5)),t||(t=o),t},updateBackupData:function(e){null==e.backupTotal&&(e.status=o.backup.status.PENDING,e.statistics={total:0,success:0,failures:0},e.createdTime=(new Date).toLocaleString())},updateBackupConfigFromUpdates:function(e,t){Object.assign(e,t),r.optionalKeys.forEach(function(n){!(n in t)&&n in e&&delete e[n]})}};e.exports=r},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(9),c=n(1).config.database,s=function(e){function t(e){var n=e.server,a=e.port,i=e.username,u=e.password,s=e.authDB,l=void 0===s?"admin":s;o(this,t);var f=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{server:n,port:a,username:i,password:u,authDB:l}));return f.backupConfigDBName=c.backup_config_db||"backup_config",f.configCollectionName="configurations",f.logsCollectionName="logs",f.copyDBsCollectionName="copyDatabases",f.tokenCollectionName="tokens",f}return a(t,e),i(t,[{key:"getBackupConfigs",value:function(){return this.readFromCollection(this.backupConfigDBName,this.configCollectionName,{})}},{key:"getBackupConfig",value:function(e){return this.readFromCollection(this.backupConfigDBName,this.configCollectionName,{id:e})}},{key:"getAllCopyDBs",value:function(){return this.readFromCollection(this.backupConfigDBName,this.copyDBsCollectionName,{})}},{key:"getBackupCopyDBsWithId",value:function(e){return this.readFromCollection(this.backupConfigDBName,this.copyDBsCollectionName,{id:e})}},{key:"getBackupLogs",value:function(e){return this.readFromCollection(this.backupConfigDBName,this.logsCollectionName,{id:e})}},{key:"updateBackupConfig",value:function(e){return this.updateDocsInCollection(this.backupConfigDBName,this.configCollectionName,e,{id:e.id})}},{key:"updateCopyDB",value:function(e){return this.updateDocsInCollection(this.backupConfigDBName,this.copyDBsCollectionName,e,{id:e.id,name:e.name})}},{key:"addCopyDB",value:function(e){return this.writeToCollection(this.backupConfigDBName,this.copyDBsCollectionName,[e])}},{key:"addLog",value:function(e){return this.writeToCollection(this.backupConfigDBName,this.logsCollectionName,[e])}},{key:"deleteCopyDBByIDAndName",value:function(e,t){return this.deleteDocs(this.backupConfigDBName,this.copyDBsCollectionName,{id:e,name:t})}},{key:"deleteBackupConfig",value:function(e){return this.deleteDocs(this.backupConfigDBName,this.configCollectionName,{id:e})}},{key:"clearLogsByID",value:function(e){return this.deleteDocs(this.backupConfigDBName,this.logsCollectionName,{id:e})}},{key:"setToken",value:function(e){return this.writeToCollection(this.backupConfigDBName,this.tokenCollectionName,[e])}},{key:"getToken",value:function(e){return this.readFromCollection(this.backupConfigDBName,this.tokenCollectionName,e)}},{key:"updateTokens",value:function(e,t){return this.updateDocsInCollection(this.backupConfigDBName,this.tokenCollectionName,e,t,!0)}}]),t}(u);e.exports=s},function(e,t,n){"use strict";var o=n(0),r=n(31),a=n(39),i=(n(25),n(26)),u=n(27),c=n(33),s=n(35),l=n(40),f=o.Router();f.use(a.json()),f.use(a.urlencoded({extended:!0})),f.use(l()),f.use(u.validate),f.get("/",function(e,t){t.sendFile(c.indexFile)}),f.use("/dist",c.publicPath),f.use("/api",r),f.use("/user",s),f.use(i),e.exports=f},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t,n){"use strict";var o=function(e){var t=n(1);t.setConfig(e);var o=t.config,r=(n(8),n(0)),a=n(18),i=n(17),u=n(16),c=n(5),s=n(15),l=n(4),f=n(7),p=n(11),d=r(),h=i.createServer(d),k=a(h);c.deployPromiseFinally(),k.on("connection",function(){}),d.use("/",u);var g=c.selfish(new s(o.database));g.connect().then(function(){h.listen(o.server.port,function(e,t){e?console.error("Failed to start the server for "+e.message):(console.log("*".repeat(60)),console.log("MongoDB Backup Manager now is listening at "+o.server.port+"!"),console.log("*".repeat(60)),l.setLocalDB(g),l.setServerSocket(k),p.setController(l),f.setDB(g),l.restart(),p.start(o.server.interval))})}).catch(function(e){g.close(),process.exit(1)})};e.exports={start:o}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(6),i=n(3),u=(n(1).config,n(9)),c=n(5),s=n(14),l=n(13),f=n(11),p=(n(6),function(){function e(t,n,r){o(this,e),this.backupDB=c.selfish(new u(n)),this.localDB=t,this.serverSocket=r,this.backupConfig=n,this.currentBackupCollections=null}return r(e,[{key:"start",value:function(){if(this.checkBackupAvailable()){var e=s.getNextBackupTime(this.backupConfig);this.updateBackupConfigToDB({nextBackupTime:e?e.toLocaleString():null,status:a.backup.status.WAITING});var t=l.newTask(this.backupConfig.id,e.valueOf(),a.task.BACKUP,{interval:this.backupConfig.interval});f.addTask(t)}}},{key:"resume",value:function(){var e=this;return this.updateBackupConfigToDB({status:this.backupConfig.statusBeforeStop,nextBackupTime:this.backupConfig.nextBackupTimeBeforeStop}).then(function(){return e.restart()})}},{key:"restart",value:function(){this.backupStatus!=a.backup.status.STOP&&(this.start(),this.deleteExtraCopyDBs(),this.deleteOverdueCopyDBs())}},{key:"checkBackupAvailable",value:function(){return this.backupStatus!=a.backup.status.STOP}},{key:"stop",value:function(){var e=this;return Promise.resolve().then(function(){if(e.backupStatus==a.backup.status.RUNNING)throw new Error("Failed to stop backup schedule, because backup is still running")}).then(function(){return e.backupDB.close()}).then(function(){return e.updateBackupConfigToDB({status:a.backup.status.STOP,nextBackupTime:null,nextBackupTimeBeforeStop:e.backupConfig.nextBackupTime,statusBeforeStop:e.backupConfig.status})}).then(function(){return e.removeAllTasksFromTaskPool(),e.addLog("Stop all the backup tasks")}).catch(function(t){throw e.addLog("Failed to stop backup for "+t.message,"error"),t})}},{key:"backup",value:function(){var e=this,t=new Date,n=this.getTargetBackUpDBName(t),o=this.backupConfig.status;return Promise.resolve().then(function(){if(o==a.backup.status.RUNNING)throw new Error("backup is running");return e.addLog("Start to backup "+e.backupConfig.db)}).then(this.backupDB.connect).then(function(){return e.updateBackupConfigToDB({status:a.backup.status.RUNNING})}).then(function(){return e.getBackupCollections()}).then(function(t){return i.debug("Successfully get backup collections "+t+" from "+e.backupConfig.db),e.currentBackupCollections=t,e.backupDB.readFromCollections(e.backupConfig.db,t)}).then(function(t){return e.backupDB.close().then(function(){return i.debug("Closed "+e.backupDB.url)}).catch(function(t){return i.error("Failed to close "+e.backupDB.url+" for "+t.message)}),e.localDB.writeToCollections(n,t)}).then(function(){return e.backupOnWriteSuccess(o,n)}).catch(function(t){throw e.backupOnFailure(o,t,n),t})}},{key:"restore",value:function(e,t){var n=this;return this.backupDB.connect().then(function(){return n.localDB.readFromCollections(e,t)}).then(function(e){return n.backupDB.deleteCollections(n.backupConfig.db,t).then(function(){return n.backupDB.writeToCollections(n.backupConfig.db,e)})}).then(function(){return n.addLog("Retored "+t.join(" and ")+" from "+e+" to the "+n.backupConfig.id+" successfully")}).catch(function(o){throw n.addLog("Failed to restore "+t.join(" and ")+" from "+e+" to "+n.backupConfig.id+" for "+o.message),o}).finally(function(){n.backupDB.close()})}},{key:"getNextStatus",value:function(e){var t=e;return e!=a.backup.status.WAITING||this.backupConfig.interval||(t=a.backup.status.PENDING),t}},{key:"removeAllTasksFromTaskPool",value:function(){f.removeTasksWithBackupId(this.backupConfig.id)}},{key:"backupOnWriteSuccess",value:function(e,t){var n=this,o=new Date,r=this.backupConfig.duration,u=r?new Date(o.valueOf()+r):null;return this.addBackupCopyDB(t,o,u).then(function(){return n.addLog("Backup "+n.backupConfig.db+" to "+t+" successfully")}).then(function(){return n.deleteExtraCopyDBs()}).then(function(){if(u){var o=l.newTask(n.backupConfig.id,u.valueOf(),a.task.DELETE_DB,{dbName:t});f.addTask(o),i.debug(t+" will be deleted at "+u.toLocaleString())}return n.updateBackupConfigAfterBackup(e,a.backup.result.SUCCEED)}).catch(function(e){throw e})}},{key:"backupOnFailure",value:function(e,t,n){var o=this;return this.addLog("Backup "+this.backupConfig.db+" failed for "+t.message,"error"),this.updateBackupConfigAfterBackup(e,a.backup.result.FAILED).finally(function(){o.deleteCopyDB(n)})}},{key:"updateBackupConfigAfterBackup",value:function(e,t){var n=this.backupConfig.statistics;n.total+=1,t===a.backup.result.SUCCEED?n.success+=1:n.failures+=1;var o=t,r=this.getNextStatus(e),i=(new Date).toLocaleString(),u={lastBackupResult:o,statistics:n,status:r,lastBackupTime:i};return this.updateBackupConfigToDB(u)}},{key:"getTargetBackUpDBName",value:function(e){return this.backupConfig.db+"-"+e.valueOf()}},{key:"getBackupCollections",value:function(){var e=this;return new Promise(function(t,n){if(e.backupConfig.collections)return t(e.backupConfig.collections);e.backupDB.getCollectionNamesWithDB(e.backupConfig.db).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"getOriginalDB",value:function(){var e=this;return this.backupDB.connect().then(function(){return e.backupDB.getCollectionNamesWithDB(e.backupConfig.db)}).then(function(t){return{id:e.backupConfig.id,db:e.backupConfig.db,collections:t}}).finally(function(){e.backupDB.close()})}},{key:"getCollections",value:function(e){var t=this;return e!=this.backupConfig.db?this.localDB.getCollectionNamesWithDB(e).then(function(t){return{db:e,collections:t}}):this.backupDB.connect().then(function(){return t.backupDB.getCollectionNamesWithDB(t.backupConfig.db)}).then(function(n){return{id:t.backupConfig.id,db:e,collections:n}}).finally(function(){t.backupDB.close()})}},{key:"getDataFromCollection",value:function(e,t,n){var o=this;return e!=this.backupConfig.db?this.localDB.readFromCollection(e,t,n):this.backupDB.connect().then(function(){return o.backupDB.readFromCollection(e,t,n)}).finally(function(){o.backupDB.close()})}},{key:"addLog",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",o={id:this.backupConfig.id,level:n,time:(new Date).valueOf(),content:e};this.localDB.addLog(o).then(function(){i.debug("Added log "+t.backupConfig.id)}).catch(function(e){throw i.error("Failed to add log for "+t.backupConfig.id+" for "+e.message),e}).finally(function(){var e=t.backupConfig.id+"-logs";t.serverSocket.emit(e)})}},{key:"updateBackupConfig",value:function(e){var t=this,n=this.backupConfig,o=n.id,r=n.duration;return s.updateBackupConfigFromUpdates(this.backupConfig,e),Promise.resolve().then(function(){return t.stop()}).then(function(){return t.localDB.updateBackupConfig(t.backupConfig)}).then(function(){t.serverSocket.emit("backupConfigs",o)}).then(function(){return t.backupDB.setConnectionParams(t.backupConfig),t.updateBackupConfigToDB({status:a.backup.status.PENDING})}).then(function(){return e.hasOwnProperty("duration")&&e.duration!==r?t.localDB.getBackupCopyDBsWithId(o):void 0}).then(function(n){if(null!=n)return n.forEach(function(t){t.deletedTime=e.duration?new Date(new Date(t.createdTime).valueOf()+e.duration).toLocaleString():null}),Promise.all(n.map(function(e){return t.localDB.updateCopyDB(e)}))}).then(function(){t.serverSocket.emit("copyDBs",o)}).then(function(){return t.restart()})}},{key:"updateBackupConfigToDB",value:function(e){var t=this;return Object.assign(this.backupConfig,e),this.localDB.updateBackupConfig(this.backupConfig).finally(function(){t.serverSocket.emit("backupConfigs",t.backupConfig.id)})}},{key:"addBackupCopyDB",value:function(e,t,n){var o=this,r={id:this.backupConfig.id,originalDatabase:{server:this.backupConfig.server,database:this.backupConfig.db},name:e,collections:this.currentBackupCollections,createdTime:t.toLocaleString(),deletedTime:n&&n.toLocaleString()};return this.localDB.addCopyDB(r).finally(function(){o.serverSocket.emit("copyDBs",o.backupConfig.id)})}},{key:"deleteCopyDB",value:function(e){var t=this;return i.debug("Started to delete "+e),this.localDB.deleteCopyDBByIDAndName(this.backupConfig.id,e).then(function(){return t.localDB.deleteDatabase(e)}).then(function(){var n=new Date;return t.addLog("Deleted "+e+" at "+n.toLocaleString())}).catch(function(n){throw t.addLog("Failed to delete "+e+" for "+n.message,"error"),n}).finally(function(){t.serverSocket.emit("copyDBs",t.backupConfig.id)})}},{key:"deleteCopyDBs",value:function(e){var t=this;return i.debug("Started to delete "+e),0==e.length?Promise.resolve():Promise.all(e.map(function(e){return t.deleteCopyDB(e)}))}},{key:"deleteCollections",value:function(e,t){var n=this;return e!=this.backupConfig.db?this.localDB.deleteCollections(e,t).then(function(){return n.addLog("Deleted "+t+" of "+e)}).catch(function(o){throw n.addLog("Failed to delete "+t+" of "+e+" for "+o.message+" ","error"),o}):this.backupDB.connect().then(function(){return n.backupDB.deleteCollections(n.backupConfig.db,t)}).finally(function(){n.backupDB.close()})}},{key:"deleteExtraCopyDBs",value:function(){var e=this;return new Promise(function(t,n){var o=e.backupConfig.maxBackupNumber;if(!o)return t();e.localDB.getBackupCopyDBsWithId(e.backupConfig.id).then(function(n){var r=n.length;if(r<=o)return t();i.debug("Start to deleted "+(r-o)+" extra DBs"),n=c.sortByTime(n,"createdTime",!0);var a=n.slice(o,r);return Promise.all(a.map(function(t){return e.deleteCopyDB(t.name)}))}).then(function(){t()}).catch(function(t){e.addLog("Failed to deleted extra backup copies for "+t.message,"error"),n(t)})})}},{key:"deleteOverdueCopyDBs",value:function(){var e=this;return Promise.resolve().then(function(){return e.localDB.getBackupCopyDBsWithId(e.backupConfig.id)}).then(function(t){return Promise.all(t.map(function(t){var n=t.deletedTime,o=t.name;if(n){var r=l.newTask(e.backupConfig.id,n,a.task.DELETE_DB,{dbName:o});f.addTask(r),i.debug(o+" will be deleted at "+n)}return Promise.resolve()}))}).catch(function(t){throw i.error("Failed to deleted all the overdue databases for "+e.backupConfig.id+" for "+t.message),t})}},{key:"clear",value:function(){var e=this,t=this.backupConfig.id;return this.stop().then(function(){return e.localDB.getBackupCopyDBsWithId(t)}).then(function(t){return e.deleteCopyDBs(t.map(function(e){return e.name}))}).then(function(){return e.localDB.clearLogsByID(t)}).then(function(){return e.localDB.deleteBackupConfig(t)}).finally(function(){e.serverSocket.emit("backupConfigs",e.backupConfig.id)})}},{key:"backupStatus",get:function(){return this.backupConfig.status}},{key:"nextBackupTime",get:function(){return this.backupConfig.nextBackupTime}}]),e}());e.exports=p},function(e,t,n){"use strict";var o={status:{PENDING:"PENDING",WAITING:"WAITING",RUNNING:"RUNNING",STOP:"STOP"},result:{SUCCEED:"SUCCEED",FAILED:"FAILED"}};e.exports=o},function(e,t,n){"use strict";var o={DELETE_DB:"DELETE_DB",BACKUP:"BACKUP"};e.exports=o},function(e,t,n){"use strict";var o=n(24),r=n(2),a=n(7),i=n(10),u=n(12),c={localDB:null,validateUser:function(e,t,n,i){if(o.isAdmin(e)){var c=a.newToken(t);a.setTokenToDB(c).then(function(){n.cookie("token",c.token),i(r.success(c))},function(e){i(r.error(e.message))})}else i(r.error(u.AUTH_ERROR,u.CODE))},logoutUser:function(e,t,n,o){var c=i.getIp(t),s=i.getUserAgent(t);a.getTokensFromDB({token:e,ip:c,user_agent:s,valid:!0}).then(function(t){return 0===t.length?void o(r.error(u.AUTH_ERROR,u.code)):a.invalidateTokens({token:e,ip:c,user_agent:s,valid:!0}).then(function(){n.cookie("token",null)})}).then(function(){o(r.success())}).catch(function(e){o(r.error(u.AUTH_ERROR,u.CODE))})}};e.exports=c},function(e,t,n){"use strict";var o=n(1).config,r={isAdmin:function(e){return e.username==o.auth.username&&e.password==o.auth.password}};e.exports=r},function(e,t,n){"use strict";var o=n(3),r=function(e,t,n){o.debug("Request from "+e.originalUrl),n()};e.exports=r},function(e,t,n){"use strict";var o=n(2),r=function(e,t,n,r){o.send(n,e)};e.exports=r},function(e,t,n){"use strict";var o=n(2),r=n(10),a=n(7),i=n(12),u=(n(3),{validate:function(e,t,n){if(!u.neededAuthenticated(e))return n();var c=e.cookies.token;if(null==c)return void o.send(t,o.error(i.AUTH_ERROR,i.CODE));var s=r.getIp(e),l=r.getUserAgent(e),f=(new Date).valueOf();a.getTokensFromDB({token:c,ip:s,user_agent:l,valid:!0,exp_time:{$gt:f}}).then(function(e){if(0==e.length)throw void 0;n()}).catch(function(e){o.send(t,o.error(i.AUTH_ERROR,i.CODE))})},neededAuthenticated:function(e){var t=e.originalUrl;return!("/"===t||"/user/auth/login"==t||t.indexOf("dist")>=0)}});e.exports=u},function(e,t,n){"use strict";var o=n(0),r=(n(2),n(4)),a=o.Router();a.post("/create",function(e,t,n){var o=e.body;r.newBackup(o,n)}),a.get("/status",function(e,t,n){var o=e.query.id;r.getBackupStatus(o,n)}),a.get("/configs",function(e,t,n){r.getAllBackupConfigs(n)}),a.get("/config",function(e,t,n){var o=e.query.id;r.getBackupConfig(o,n)}),a.post("/run",function(e,t,n){var o=e.body;r.runBackup(o.id,n)}),a.patch("/update",function(e,t,n){var o=e.body.id,a=e.body.updates;r.updateBackupConfig(o,a,n)}),a.post("/stop",function(e,t,n){var o=e.body.id;r.stop(o,n)}),a.post("/resume",function(e,t,n){var o=e.body.id;r.resume(o,n)}),a.post("/restore",function(e,t,n){var o=e.body,a=o.id,i=o.db,u=o.collections;r.restore(a,i,u,n)}),a.delete("/delete",function(e,t,n){var o=e.query.id;r.deleteBackup(o,n)}),a.delete("/:backupID/databases/:dbName",function(e,t,n){var o=e.params.backupID,a=e.params.dbName;r.deleteCopyDB(o,a,n)}),e.exports=a},function(e,t,n){"use strict";var o=n(0),r=(n(2),n(4)),a=o.Router();a.delete("/",function(e,t,n){var o=e.body,a=o.id,i=o.db,u=o.collections;r.deleteCollections(a,i,u,n)}),a.get("/",function(e,t,n){var o=e.query,a=o.id,i=o.db;r.getCollections(a,i,n)}),a.get("/data",function(e,t,n){var o=e.query,a=o.id,i=o.db,u=o.collection;r.getDataFromCollection(a,i,u,n)}),e.exports=a},function(e,t,n){"use strict";var o=n(0),r=(n(2),n(4)),a=o.Router();a.get("/availableDBs",function(e,t,n){var o=e.query;r.getAvailableDBsCollections(o,n)}),a.get("/copyDBs",function(e,t,n){var o=e.query.id;r.getBackupCopyDBs(o,n)}),a.get("/originalDB",function(e,t,n){var o=e.query.id;r.getOriginalDB(o,n)}),a.get("/allOriginalDBs",function(e,t,n){r.getAllOriginalDBs(n)}),a.get("/allCopyDBs",function(e,t,n){r.getAllBackupCopyDBs(n)}),a.delete("/",function(e,t,n){var o=e.query,a=o.id,i=o.db;r.deleteDB(a,i,n)}),e.exports=a},function(e,t,n){"use strict";var o=n(0),r=n(28),a=n(30),i=n(29),u=n(32),c=o.Router();c.use("/backups",r),c.use("/databases",a),c.use("/collections",i),c.use("/logs",u),e.exports=c},function(e,t,n){"use strict";var o=n(0),r=n(4),a=o.Router();a.get("/",function(e,t,n){var o=e.query.id;r.getAllBackupLogs(o,n)}),e.exports=a},function(e,t,n){"use strict";var o=n(0),r=n(8),a=o.static(r.join(__dirname,"../dist")),i=r.join(__dirname,"../dist/index.html");e.exports={publicPath:a,indexFile:i}},function(e,t,n){"use strict";var o=n(0),r=o.Router(),a=n(23);r.post("/login",function(e,t,n){var o=e.body;a.validateUser(o,e,t,n)}),r.post("/logout",function(e,t,n){var o=e.cookies.token;a.logoutUser(o,e,t,n)}),e.exports=r},function(e,t,n){"use strict";var o=n(0),r=n(34),a=n(36),i=o.Router();i.use("/auth",r),i.use("/operation",a),e.exports=i},function(e,t,n){"use strict";var o=n(0),r=o.Router();r.post("/create",function(e,t,n){}),r.delete("remove",function(e,t,n){}),e.exports=r},function(e,t,n){"use strict";var o={getMongoUri:function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"admin";return"mongodb://"+(e&&t?e+":"+t+"@":"")+n+":"+o+"/"+r}};e.exports=o},function(e,t){e.exports=require("basic-logger")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("mongodb")},function(e,t){e.exports=require("strip-json-comments")}]);